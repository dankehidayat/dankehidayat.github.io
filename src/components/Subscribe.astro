---
import siteConfig from '../data/site-config';

type Props = { class?: string };

const { class: className } = Astro.props;
const subscribe = siteConfig.subscribe;
if (!subscribe?.enabled) {
    return;
}
---

<section class:list={['border-main flex flex-col items-center gap-2 border border-dashed px-8 py-12 text-center sm:px-12 sm:py-16', className]}>
    {subscribe.title && <h2 class="w-full max-w-xl font-serif text-2xl leading-tight font-medium sm:text-4xl">{subscribe.title}</h2>}
    {subscribe.text && <p class="w-full max-w-xl text-sm leading-normal">{subscribe.text}</p>}
    <div class:list={['flex w-full max-w-xl flex-col items-center gap-3 sm:flex-row sm:justify-center', { 'mt-6': subscribe.title || subscribe.text }]}>
        <button
            id="rss-copy-btn"
            class="text-main border-main hover:bg-main/10 cursor-pointer rounded border bg-transparent px-4 py-2 text-sm transition-all duration-200 hover:shadow-sm active:scale-95"
            data-rss-link={subscribe.rssLink}
            title="Click to copy RSS link"
        >
            <span id="btn-text">{subscribe.rssLink}</span>
        </button>
    </div>
</section>

<style>
    @keyframes slideOut {
        from {
            opacity: 1;
            transform: translateY(0);
        }
        to {
            opacity: 0;
            transform: translateY(-8px);
        }
    }

    @keyframes slideIn {
        from {
            opacity: 0;
            transform: translateY(8px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .slide-out {
        animation: slideOut 0.3s ease-out forwards;
    }

    .slide-in {
        animation: slideIn 0.3s ease-out forwards;
    }
</style>

<script>
    const btn = document.getElementById('rss-copy-btn');
    const btnText = document.getElementById('btn-text');
    if (btn && btnText) {
        btn.addEventListener('click', async () => {
            const rssLink = btn.getAttribute('data-rss-link');
            if (rssLink) {
                try {
                    await navigator.clipboard.writeText(rssLink);
                    const originalText = btnText.textContent;

                    // Animate text out
                    btnText.classList.add('slide-out');

                    setTimeout(() => {
                        // Change text and animate in
                        btnText.textContent = 'Copied!';
                        btnText.classList.remove('slide-out');
                        btnText.classList.add('slide-in', 'animate-pulse');
                    }, 150);

                    // Reset after delay
                    setTimeout(() => {
                        btnText.classList.add('slide-out');
                        btnText.classList.remove('slide-in', 'animate-pulse');

                        setTimeout(() => {
                            btnText.textContent = originalText;
                            btnText.classList.remove('slide-out');
                            btnText.classList.add('slide-in');
                        }, 150);
                    }, 2000);
                } catch (err) {
                    console.error('Failed to copy:', err);
                }
            }
        });
    }
</script>
